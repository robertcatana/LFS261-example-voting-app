pipeline {
	agent any
	tools{
		nodejs 'nodejs 22.5.1'
		}
	stages{
		stage("build"){
			when{
				changeset "**/result/**"
				}
			steps{
				echo 'Building worker app..'
				dir('result'){
					sh 'npm install'
				}
			}
		}
		stage("test"){
			when{
				changeset "**/result/**"
			}
			steps{
				echo 'Running Unit Tets on worker app..'
				dir('result'){
					sh 'npm install'
					sh 'npm test'
				}
			}
		}
		stage("Push to Git Repository") {
            steps {
                withCredentials([gitUsernamePassword(credentialsId: 'auth token for github', gitToolName: 'Default')]) {
                    sh "git push -u origin resultbranch"
                }
            }
		}
	post{
		always{
			echo 'Building multibranch pipeline for worker is completed..'
		}
	}
}
